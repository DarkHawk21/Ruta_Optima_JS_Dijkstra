<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ProyectoEDA</title>
	<link rel="stylesheet" href="css/styles.css">
</head>
<body>
	<section class="principalContainer">
		<div class="divBotones">
			<button id="btnCreateVertice" class="btnCreateVertice">Crear Vértice</button>
			<button id="btnCreateEdge" class="btnCreateEdge">Crear Arista</button>
			<button id="btnRoute" class="btnRoute">Calcular Ruta</button>

			<form action="#" class="formVertices form">
				<label for="positionVertice">Posición del vértice en coordenadas (x,y)</label>
				<div class="formRow">
					<input type="number" id="positionX" min="0" max="100" placeholder="X">
					<input type="number" id="positionY" min="0" max="100" placeholder="Y">
				</div>

				<label for="nameVertice">Nombre del vértice</label>
				<div class="formRow">
					<input type="text" id="nameVertice" placeholder="Nombre del vertice">
					<input type="submit" id="btnCrearV" value="Crear vértice" class="btn"></input>
				</div>
			</form>

			<form action="#" class="formEdges form">
				<label for="initialV">Vértice inicial</label>
				<select id="initialV"></select>

				<label for="finalV">Vértice final</label>
				<select id="finalV"></select>

				<input type="submit" id="btnCrearE" value="Crear arista" class="btn"></input>
			</form>

			<form action="#" class="formCalculate form">
				<label for="initialVC">Vértice inicial</label>
				<select id="initialVC"></select>

				<label for="finalVC">Vértice final</label>
				<select id="finalVC"></select>

				<input type="submit" id="btnCalcRoute" value="Calcular ruta" class="btn"></input>
			</form>

			<button id="btnClear" class="btnClear">Limpiar</button>
		</div>

		<div class="divMapa">
			<canvas id="mapa"></canvas>
		</div>
	</section>

	<script src="js/jquery-3.4.1.min.js"></script>
	<script src="js/Dijkstra.js"></script>
	<script>
		$(document).ready(function() {
			clearInformation();
			
			$("#btnCreateVertice").click(function() {
				clearForms();
				$(".formVertices").slideDown(300);
				$("#positionX").focus();
			});

			$("#btnCreateEdge").click(function() {
				clearForms();
				$(".formEdges").slideDown(300);
				$("#positionX").focus();
			});

			$("#btnRoute").click(function() {
				clearForms();
				$(".formCalculate").slideDown(300);
			});
		});

		$("#btnClear").click(function() {
			clearInformation();
		});

		function clearInformation() {
			$("#mapa").html('');
			$(".form input:not(input[type='submit'])").val('');
			$(".form select").val('');
		}

		function clearFormData() {
			$(".form input:not(input[type='submit'])").val('');
			$(".form select").val('');
		}

		function clearForms() {
			$(".form").slideUp(300);
		}

		function fillSelects() {
			let initialV = document.getElementById("initialV");
			let finalV = document.getElementById("finalV");
			let initialVC = document.getElementById("initialVC");
			let finalVC = document.getElementById("finalVC");

			let optionDefault1 = document.createElement("option");
			optionDefault1.text = "...";
			optionDefault1.value = "";
			initialV.add(optionDefault1);

			let optionDefault2 = document.createElement("option");
			optionDefault2.text = "...";
			optionDefault2.value = "";
			finalV.add(optionDefault2);

			let optionDefault3 = document.createElement("option");
			optionDefault3.text = "...";
			optionDefault3.value = "";
			initialVC.add(optionDefault3);

			let optionDefault4 = document.createElement("option");
			optionDefault4.text = "...";
			optionDefault4.value = "";
			finalVC.add(optionDefault4);

			let nodos = Object.keys(grafo);

			for (let i = 0; i < nodos.length; i++) {
				let optionInitial = document.createElement("option");
				optionInitial.text = nodos[i];
				optionInitial.value = nodos[i];
				initialV.add(optionInitial);

				let optionInitialC = document.createElement("option");
				optionInitialC.text = nodos[i];
				optionInitialC.value = nodos[i];
				initialVC.add(optionInitialC);

				let optionFinal = document.createElement("option");
				optionFinal.text = nodos[i];
				optionFinal.value = nodos[i];
				finalV.add(optionFinal);

				let optionFinalC = document.createElement("option");
				optionFinalC.text = nodos[i];
				optionFinalC.value = nodos[i];
				finalVC.add(optionFinalC);
			}
		}

		$("#btnCrearV").click(function(e){
			e.preventDefault();
			let x = parseInt($("#positionX").val());
			let y = parseInt($("#positionY").val());
			let nameV = $("#nameVertice").val();

			if (x >= 0 && y >= 0 && x <= 100 && y <= 100 && nameV != "" && x != null && y != null && nameV != null) {
				let coordenada = [x,y];
				let existe = false;
				let queExiste = "";

				if (Object.keys(coordenadas).length > 0) {
					// Valida que las coordenadas no existan ya en el grafo.
					for (const vertice in coordenadas) {
						for (let i = 0; i < coordenadas[vertice].length; i++) {
							if (coordenadas[vertice][0] == x && coordenadas[vertice][1] == y) {
								existe = true;
								queExiste += `Ya existen las coordenadas (${x},${y}) | `;
								i = coordenadas[vertice].length;
							}
						}
					}

					// Valida que el nombre del vertice a ingresar no tenga el mismo nombre que alguno ya almacenado.
					if ([nameV] in grafo) {
						existe = true;
						queExiste += `Ya existe un vertice con el nombre ${nameV} | `;
					}

					if (!existe) {
						coordenadas[nameV] = [x,y];
						grafo[nameV] = {};
						$(".form select option").each(function() {
							$(this).remove();
						});
						fillSelects();
						clearFormData();
						$("#positionX").focus();
					} else {
						alert(queExiste);
					}
				} else {
					coordenadas[nameV] = [x,y];
					grafo[nameV] = {};
					$(".form select option").each(function() {
						$(this).remove();
					});
					fillSelects();
					clearFormData();
					$("#positionX").focus();
				}
			} else {
				alert("Por favor introduce los datos.");
			}
		});

		$("#btnCrearE").click(function(e){
			e.preventDefault();
			let initialV = $("#initialV").val();
			let finalV = $("#finalV").val();

			if (initialV != "" && finalV != "" && initialV != null && finalV != null) {
				// Cuando es un digrafo, solo se añade el vecino al primer nodo (initialV).
				let x1 = coordenadas[initialV][0];
				let y1 = coordenadas[initialV][1];
				let x2 = coordenadas[finalV][0];
				let y2 = coordenadas[finalV][1];
				let peso = Math.sqrt(Math.pow((x2 - x1), 2) + Math.pow((y2 - y1), 2));
				grafo[initialV][finalV] = Math.round(peso);
				console.log("Se añadió una arista:");
				console.log(grafo);
				clearFormData();
			} else {
				alert("Por favor introduce los datos.");
			}
		});

		$("#btnCalcRoute").click(function(e) {
			e.preventDefault();
			let initialV = $("#initialVC").val();
			let finalV = $("#finalVC").val();

			if (initialV != "" && finalV != "" && initialV != null && finalV != null) {
				console.log(dijkstra(grafo, initialV, finalV));
			} else {
				alert("Por favor introduce los datos.");
			}
		});
	</script>
</body>
</html>